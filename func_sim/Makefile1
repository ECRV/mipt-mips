CC := gcc
CFLAGS := -Wall -c -g
TARGET := Debug
Debug := 1

SRC_DIR := ./
BIN_DIR := bin
OBJ_DIR := obj
TRUNK= ../

#ifeq ($(Debug), 1)
#        CFLAGS := $(CFLAGS) -O0 -g
#else
#        CFLAGS := $(CFLAGS) -O2
#endif

OBJS:=$(wildcard *.o */*.o)
INCL= -I $(SRC_DIR) -I $(TRUNK)/common/ -I $(SRC_DIR)/elf_parser/ -I $(SRC_DIR)/func_memory/ -I $(SRC_DIR)/func_instr/

Debug: all

all: 
	cd elf_parser/ && $(MAKE) # $(TARGET)
	cd func_instr/ && $(MAKE) # $(TARGET)
	cd func_memory/ && $(MAKE) # $(TARGET)
	$(CC) $^ $(CFLAGS) $(INCL) func_sim.cpp -o func_sim.o
	$(CC) $^ $(CFLAGS) $(INCL) main.cpp -o main.o
	$(CC) -g $^ $(OBJS) -o $(SRC_DIR)/func_sim

func_memory:
	cd func_memory/ && $(MAKE) # $(TARGET)

func_instr:
	cd func_instr/ && $(MAKE) # $(TARGET)

elf_parser:
	cd elf_parser/ && $(MAKE) # $(TARGET)

func_sim:
	$(CC) $(INCL) $(CFLAGS) func_sim.cpp main.cpp

